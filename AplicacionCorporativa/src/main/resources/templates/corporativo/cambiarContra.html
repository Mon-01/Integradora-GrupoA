<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recuperación de contraseña</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background-color: #f4f4f4; }
        .login-container { display: flex; justify-content: center; align-items: center; height: 80vh; }
        .login-box {
            background: white; padding: 2rem; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 400px; width: 100%;
        }
        .login-box h2 { margin-bottom: 1.5rem; text-align: center; color: #d32f2f; }
        .login-box form { display: flex; flex-direction: column; }
        .login-box input { padding: 10px; margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 5px; }
        .login-box button {
            background-color: #d32f2f; color: white; border: none;
            padding: 10px; border-radius: 5px; cursor: pointer;
        }
        .login-box button:hover { background-color: #b71c1c; }
        .error { color: red; text-align: center; margin-bottom: 1rem; }
        .login-box a { text-align: center; display: block; margin-top: 1rem; color: #d32f2f; text-decoration: none; }
        .login-box a:hover { text-decoration: underline; }
        .login-box p { text-align: center; display: block; margin-top: 1rem; color: #d32f2f; text-decoration: none; }
    </style>
</head>
<body>

<!-- Incluir barra de navegación -->
<div th:replace="~{fragments/nav :: navbar}"></div>

<div class="login-container">
    <div class="login-box">
        <h2>Cambiar contraseña</h2>

        <div th:if="${error}" class="error" th:text="${error}"></div>

        <form id="formCambioClave">
            <input type="hidden" id="id_usuario" th:value="${usuarioDTO.id_usuario}" />

            <label>¿Dónde has nacido?</label>
            <input type="text" id="respuestaSecreta"><br>

            <label>Nueva Contraseña:</label>
            <input type="password" id="clave"><br>

            <label>Confirmar Contraseña:</label>
            <input type="password" id="confirmarClave"><br>
            <button type="submit">Actualizar Contraseña</button>
        </form>
    </div>
</div>
<script>
    function mostrarContra() {
        const input = document.getElementById("pass");
        const input2 = document.getElementById("passconf");
        input.type = input.type === "password" ? "text" : "password";
        input2.type = input2.type === "password" ? "text" : "password";
    }

    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("formCambioClave");

        form.addEventListener("submit", function (e) {
            e.preventDefault();

            const id = document.getElementById("id_usuario").value;
            const clave = document.getElementById("clave").value;
            const confirmarClave = document.getElementById("confirmarClave").value;
            const respuestaSecreta = document.getElementById("respuestaSecreta").value;
            const mensajeDiv = document.getElementById("mensaje");

            if (clave !== confirmarClave) {
                mensajeDiv.textContent = "Las contraseñas no coinciden.";
                mensajeDiv.style.color = "red";
                return;
            }

            fetch("/api/usuarios/cambiar-clave", {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    id_usuario: id,
                    clave: clave,
                    respuestaSecreta: respuestaSecreta
                })
            })
                .then(response => {
                    if (response.ok) {
                        alert("Contraseña actualizada correctamente.");
                    } else {
                        return response.text().then(msg => {
                            alert("Error: " + msg);
                        });
                    }
                })
                .catch(error => {
                    mensajeDiv.textContent = "Error en la solicitud.";
                    mensajeDiv.style.color = "red";
                    console.error(error);
                });
        });
    });



</script>
</body>
</html>